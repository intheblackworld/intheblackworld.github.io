---
layout:     post
title:      "作用域與閉包"
subtitle:   ""
date:       2016-3-8
author:     "ZuRay"
header-img: "img/post-bg-js-version.jpg"
tags:
    - 前端开发
    - JavaScript
---

## 目標

> 1.理解 js中var的作用域  
2.了解閉包的概念  
3.理解this的指向  



## I.var 作用域重點整理

*1.  內部函式可以取用外部函式的變數*

*2.  外部函式不可取用內部函式的變數(var宣告的變數作用域在函式內)*

*3.  宣告變數時，不加var，變數會變成全域變數。*


## II.閉包重點整理

>此段落參考[理解javascript的閉包](http://coolshell.cn/articles/6731.html)


*1.  閉包是可以讓外部函式取用內部函式的變量的方法*

*2.  當在一個函數內定義另外一個函數就會產生閉包*

```
function greeting(name){
  var text = alert("Hello" + name);
}

var sayHello = greeting("Closure");  //不加這一行，sayHello()無法取用text這個內部函式的變數
sayHello();
```

3. 閉包中的5個實例



## III. this的四種類型
*1. 函式有所屬對象時，指向所屬對象*  
```
var myObject = {value :  100 };
 myObject.getValue  =  function () {
   console.log ( this.value );   //輸出100

  //輸出{ value: 100, getValue: [Function] }，
  //其實就是myObject對象本身
  console.log ( this );

  return  this.value ;
};

console.log ( myObject.getValue ()); // => 100
```
*2. 沒調用對象就指向全局對象*  

```
var myObject = {value :  100 };
 myObject.getValue  =  function () {
   var  foo  =  function () {
     console.log ( this.value ) // => undefined 
    console.log ( this ); //輸出全局對象global
  };

  foo ();

  return  this.value ;
};

console.log ( myObject . getValue ()); // => 100
```  
在上述代碼塊中，foo函數雖然定義在getValue的函數體內，但實際上它既不屬於getValue也不屬於myObject。foo並沒有被綁定在任何對像上，所以當調用時，它的this指針指向了全局對象global。
*3. 構造器中的this，指向新對象*  

```
var  SomeClass  =  function (){
   this.value  =  100 ;
}

var myCreate =  new  SomeClass ();

console.log ( myCreate.value ); //輸出100
```
*4. apply和call以及bind綁定，會指向綁定的對象*  

apply() 方法接受兩個參數第一個是函數運行的作用域，另外一個是一個參數數組(arguments)。  

call() 方法第一個參數的意義與apply() 方法相同，只是其他的參數需要一個個列舉出來。  

簡單來說，call 的方式更接近我們平時調用函數，而​​apply 需要我們傳遞Array 形式的數組給它。它們是可以互相轉換的。  

```
var myObject = {value :  100 };

var  foo  =  function (){
   console.log ( this );
};

foo (); //全局變量global 
foo.apply (myObject); // { value: 100 } 
foo.call (myObject); // { value: 100 }

var newFoo =  foo.bind (myObject);
 newFoo (); // { value: 100 }
```





### 參考資源
[作用域與閉包：this，var，(function () {})](https://github.com/alsotang/node-lessons/tree/master/lesson11)  

[理解javascript的閉包](http://coolshell.cn/articles/6731.html)